<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Eyean Master Lab</title>
    
    <!-- PWA Settings -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Eyean Lab">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/2583/2583217.png">
    <link rel="manifest" href='data:application/manifest+json,{"name":"Eyean Master Lab","short_name":"EyeanLab","start_url":".","display":"standalone","background_color":"#050608","theme_color":"#050608","icons":[{"src":"https://cdn-icons-png.flaticon.com/512/2583/2583217.png","sizes":"512x512","type":"image/png"}]}'>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Space+Mono&display=swap');
        :root { --bg: #050608; --panel: #0f1115; --sky: #38bdf8; --amber: #f59e0b; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: #f1f5f9; overflow-x: hidden; -webkit-tap-highlight-color: transparent; overscroll-behavior-y: contain; }
        .eyean-font { font-family: 'Space Mono', monospace; }
        .animate-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .confetti { position: fixed; width: 8px; height: 8px; top: -10px; border-radius: 2px; animation: fall linear forwards; z-index: 3000; }
        @keyframes fall { to { transform: translateY(100vh) rotate(720deg); } }
        .drop-shadow-glow { filter: drop-shadow(0 0 15px rgba(56, 189, 248, 0.4)); }
        .verify-bar { background: rgba(5, 6, 8, 0.98); backdrop-filter: blur(24px); border-top: 1px solid rgba(255,255,255,0.1); }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .locked { filter: grayscale(1) opacity(0.3); pointer-events: none; }
        .next-up { animation: pulse-border 2s infinite; border-color: var(--sky) !important; }
        @keyframes pulse-border { 0%, 100% { box-shadow: 0 0 0px var(--sky); } 50% { box-shadow: 0 0 12px var(--sky); } }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <header class="sticky top-0 z-[100] bg-[#050608]/95 backdrop-blur-lg border-b border-white/5 px-6 py-4 flex justify-between items-center pt-12">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-sky-500 rounded-xl flex items-center justify-center text-slate-950 font-black shadow-lg">E</div>
            <span class="font-black tracking-tighter text-sm uppercase">Eyean Lab</span>
        </div>
        <div class="text-amber-500 font-black text-xs flex items-center gap-1">
            <i data-lucide="sparkles" class="w-4 h-4"></i> <span id="xp-val">0</span>
        </div>
    </header>

    <main id="app-content" class="flex-1 max-w-xl mx-auto w-full p-6 relative pb-40">
        <!-- Views -->
    </main>

    <nav id="footer-nav" class="fixed bottom-0 left-0 right-0 bg-[#050608]/95 backdrop-blur-xl border-t border-white/5 px-6 py-4 flex justify-around items-center z-[90] pb-10">
        <button onclick="setView('path')" id="nav-path" class="flex flex-col items-center gap-1 text-sky-400">
            <i data-lucide="map" class="w-6 h-6"></i><span class="text-[8px] font-black uppercase">Journey</span>
        </button>
        <button onclick="setView('translator')" id="nav-trans" class="flex flex-col items-center gap-1 text-slate-600">
            <i data-lucide="languages" class="w-6 h-6"></i><span class="text-[8px] font-black uppercase">Translator</span>
        </button>
        <button onclick="setView('codex')" id="nav-codex" class="flex flex-col items-center gap-1 text-slate-600">
            <i data-lucide="library" class="w-6 h-6"></i><span class="text-[8px] font-black uppercase">Codex</span>
        </button>
    </nav>

    <script>
        const WEST = { 'A': 'ア', 'B': 'ש', 'C': 'ジ', 'D': '⊣', 'E': 'え', 'F': 'ε', 'G': '↸', 'H': 'チ', 'I': 'ꮦ', 'J': 'Б', 'K': 'ᓭ', 'L': '⎓', 'M': 'ꮏ', 'N': 'ք', 'O': 'ꝋ', 'P': '∷', 'Q': 'פ', 'R': 'ꮭ', 'S': '⋊', 'T': 'ꭴ', 'U': 'µ', 'V': 'ᓵ', 'W': 'ꮑ', 'X': 'є', 'Y': 'よ', 'Z': 'չ' };
        const EAST = { 'A': 'а', 'B': 'в', 'C': 'Ж', 'D': 'г', 'E': 'э', 'F': 'з', 'G': 'д', 'H': 'х', 'I': 'и', 'J': 'Б', 'K': 'с', 'L': 'ф', 'M': 'т', 'N': 'п', 'O': 'ꝋ', 'р': 'р', 'Q': 'פ', 'R': 'ꮭ', 'S': 'к', 'T': 'ꭴ', 'U': 'у', 'V': 'ᓵ', 'W': 'н', 'X': 'є', 'Y': 'й', 'Z': 'չ' };
        const SPOKEN = { 'A': 'A', 'B': 'V', 'C': 'ZH', 'D': 'G', 'E': 'E', 'F': 'Z', 'G': 'D', 'H': 'H', 'I': 'I', 'J': 'B', 'K': 'S', 'L': 'F', 'M': 'T', 'N': 'P', 'O': 'O', 'P': 'R', 'Q': 'Q', 'R': 'L', 'S': 'K', 'T': 'M', 'U': 'U', 'V': 'C', 'W': 'N', 'X': 'X', 'Y': 'Y', 'Z': 'Z' };

        // --- UNIQUE 1-12 CONTENT ATLAS ---
        const ATLAS = {
            1: { title: "Identity", icon: "user",
                 vocab: [{w:'HELLO',d:'Greeting'},{w:'NAME',d:'ID'},{w:'ELIAS',d:'Proper'},{w:'SARAH',d:'Proper'},{w:'FRIEND',d:'Ally'},{w:'AM',d:'Be(1)'},{w:'YOU',d:'Other'},{w:'KIND',d:'Nice'}],
                 sentences: ["I AM ELIAS", "YOU ARE SARAH", "SARAH IS MY FRIEND", "HELLO MY NAME IS ELIAS"],
                 story: { title: "Gate Meeting", chat: [{s:"Elias",l:"HELLO I AM ELIAS"},{s:"Sarah",l:"HELLO ELIAS I AM SARAH"}] }
            },
            2: { title: "Physicality", icon: "activity",
                 vocab: [{w:'HEAD',d:'Top'},{w:'HAND',d:'Grab'},{w:'RUN',d:'Fast'},{w:'WALK',d:'Slow'},{w:'KAEL',d:'Proper'},{w:'MIRA',d:'Proper'},{w:'STOP',d:'No move'}],
                 sentences: ["KAEL RUNS FAST", "MIRA WALKS SLOW", "STOP THE MOVE"],
                 story: { title: "Morning Run", chat: [{s:"Kael",l:"I RUN FAST MIRA"},{s:"Mira",l:"LOOK AT MY LEG"}] }
            },
            3: { title: "Gaia", icon: "sun",
                 vocab: [{w:'TREE',d:'Plant'},{w:'RIVER',d:'Water'},{w:'SUN',d:'Star'},{w:'SKY',d:'Above'},{w:'ORION',d:'Proper'},{w:'GAIA',d:'Proper'}],
                 sentences: ["THE SUN IS BRIGHT", "GAIA SEES THE TREE", "THE RIVER IS GREEN"],
                 story: { title: "Nature Walk", chat: [{s:"Orion",l:"THE SUN IS BRIGHT GAIA"},{s:"Gaia",l:"I SEE THE BLUE SKY"}] }
            },
            4: { title: "Labor", icon: "briefcase",
                 vocab: [{w:'BOSS',d:'Lead'},{w:'CLERK',d:'Worker'},{w:'OFFICE',d:'Room'},{w:'TOOL',d:'Item'},{w:'WAGE',d:'Pay'},{w:'DESK',d:'Surface'}],
                 sentences: ["THE BOSS BUILDS A TOOL", "I WORK AT THE OFFICE", "THE JOB IS BUSY"],
                 story: { title: "Office Day", chat: [{s:"Supervisor",l:"BUILD THE TOOL NOW"},{s:"Clerk",l:"I AM BUSY AT THE DESK"}] }
            },
            5: { title: "Law", icon: "shield",
                 vocab: [{w:'JUDGE',d:'Judge'},{w:'KING',d:'Ruler'},{w:'LAW',d:'Rules'},{w:'VOTE',d:'Choice'},{w:'PEACE',d:'Calm'},{w:'WAR',d:'Fight'}],
                 sentences: ["THE KING RULES LAND", "THE LAW IS REAL", "VOTE FOR PEACE"],
                 story: { title: "Legal Decree", chat: [{s:"Judge",l:"THE LAW IS REAL CITIZEN"},{s:"Citizen",l:"I VOTE FOR PEACE"}] }
            },
            6: { title: "Education", icon: "scroll",
                 vocab: [{w:'MENTOR',d:'Teacher'},{w:'SEEKER',d:'Student'},{w:'COMPASS',d:'Guide'},{w:'CORE',d:'Center'},{w:'VOID',d:'Empty'}],
                 sentences: ["MY COMPASS IS CURIOSITY", "THE CORE IS REAL", "MIND IS OPEN"],
                 story: { title: "Insight Log", chat: [{s:"Mentor",l:"MY COMPASS IS CURIOSITY"},{s:"Seeker",l:"THE CORE IS REAL"}] }
            },
            7: { title: "Signals", icon: "waves",
                 vocab: [{w:'PILOT',d:'Flyer'},{w:'TOWER',d:'Base'},{w:'RAIN',d:'Water'},{w:'SNOW',d:'Ice'},{w:'STORM',d:'Wind'}],
                 sentences: ["THE PILOT SEES RAIN", "SUMMER IS HOT", "SIGNAL IS GOOD"],
                 story: { title: "Radio Check", chat: [{s:"Pilot",l:"TOWER THE STORM IS NEAR"},{s:"Tower",l:"GO LOW PILOT STAY SAFE"}] }
            },
            8: { title: "Trade", icon: "coins",
                 vocab: [{w:'MERCHANT',d:'Seller'},{w:'BOIR',d:'Coin'},{w:'COST',d:'Value'},{w:'PAY',d:'Give'},{w:'TEN',d:'10'}],
                 sentences: ["THE FOOD COSTS TEN BOIR", "I PAY ONE BOIR", "THE PRICE IS GOOD"],
                 story: { title: "Market Talk", chat: [{s:"Merchant",l:"THE FOOD IS TEN BOIR"},{s:"Buyer",l:"I PAY THE PRICE"}] }
            },
            9: { title: "Voyage", icon: "compass",
                 vocab: [{w:'SHIP',d:'Vessel'},{w:'MAP',d:'Guide'},{w:'WAY',d:'Route'},{w:'CITY',d:'Hub'},{w:'CAPTAIN',d:'Boss'}],
                 sentences: ["THE CAPTAIN HAS THE MAP", "THE SHIP GOES FAR", "CITY IS NEAR"],
                 story: { title: "Captain's Log", chat: [{s:"Captain",l:"I HAVE THE NEW MAP"},{s:"Sailor",l:"THE SHIP GOES FAR"}] }
            },
            10: { title: "The Globe", icon: "flag",
                  vocab: [{w:'USA',d:'Land'},{w:'CHINA',d:'Land'},{w:'JAPAN',d:'Land'},{w:'WORLD',d:'All'},{w:'BORDER',d:'Edge'}],
                  sentences: ["JAPAN IS FAR", "USA IS BIG", "THE WORLD IS ONE"],
                  story: { title: "World Map", chat: [{s:"Explorer",l:"THE WORLD IS ONE"},{s:"Mapmaker",l:"JAPAN IS FAR"}] }
            },
            11: { title: "Harmony", icon: "music",
                  vocab: [{w:'SOLOIST',d:'One'},{w:'CONDUCTOR',d:'Lead'},{w:'DRUM',d:'Beat'},{w:'VIOLIN',d:'String'},{w:'SONG',d:'Music'}],
                  sentences: ["I PLAY THE DRUM", "SOLOIST PLAYS VIOLIN", "THE SONG IS LOUD"],
                  story: { title: "Rehearsal", chat: [{s:"Soloist",l:"THE SONG IS LOUD"},{s:"Conductor",l:"PLAY SOFT SONG"}] }
            },
            12: { title: "TOTAL SYNC", icon: "zap",
                  vocab: [{w:'VOICE',d:'Signal'},{w:'MASTER',d:'High'},{w:'SYNC',d:'Align'},{w:'EYEAN',d:'System'},{w:'END',d:'Final'}],
                  sentences: ["EYEAN IS REAL", "THE SYNC IS MASTER", "THE END IS NEAR"],
                  story: { title: "Final Sync", chat: [{s:"Voice",l:"TOTAL SYNC IS MASTER"},{s:"Master",l:"EYEAN IS THE END"}] }
            }
        };

        let state = {
            view: 'path',
            xp: parseInt(localStorage.getItem('eyean-xp') || 0),
            completed: JSON.parse(localStorage.getItem('eyean-lessons') || '{}'),
            activeUnit: 1, script: 1, session: null, finished: false, uFinished: false, transIn: ''
        };

        function setView(v) { 
            state.view = v; 
            state.finished = false; 
            state.uFinished = false; 
            render(); 
        }
        function scramble(w) { return w ? (w.toUpperCase()==='BOIR' ? 'BOIR' : w.toUpperCase().split('').map(c => SPOKEN[c] || c).join('')) : ""; }
        function scriptify(w, s) {
            if(!w) return "";
            if(w.toUpperCase()==='BOIR' && s===1) return 'Бꝋꮦ∷';
            const map = s===1 ? WEST : EAST;
            return w.toUpperCase().split('').map(c => map[c] || c).join('');
        }

        function isLessonLocked(uId, lIdx) {
            uId = Number(uId); lIdx = Number(lIdx);
            if (uId === 1 && lIdx === 0) return false;
            if (lIdx > 0) return !state.completed[`${uId}-${lIdx - 1}`];
            return !state.completed[`${uId - 1}-9`];
        }

        function initLesson(uId, lIdx) {
            if (isLessonLocked(uId, lIdx)) return;
            const u = ATLAS[uId];
            let p = [];
            const offset = (lIdx % 4) * 2;
            u.vocab.slice(offset, offset + 4).forEach(v => p.push({ type:'vocab', word:v.w, d:v.d, p:scramble(v.w) }));
            
            if (lIdx === 4) {
                p.push({ type:'story_read', story:u.story });
                const spk = u.story.chat[0].s.toUpperCase();
                p.push({ type:'cloze', en:`LOG: WHO IS THE PRIMARY SIGNAL?`, target:spk, opts:[spk, "MASTER", "VOICE"] });
            } else {
                const s = u.sentences[lIdx % u.sentences.length];
                const words = s.split(' ');
                const t = words[words.length - 1];
                p.push({ type:'sentence', en:s, target:s, bank: [...words, 'VOID', 'DARK', 'REAL'].sort(() => Math.random() - 0.5) });
                p.push({ type:'cloze', en:s.replace(t, "____"), target:t, opts:[t, "VOID", "STOP"] });
            }
            while(p.length < 10) p.push({ type:'vocab', word:u.vocab[0].w, d:u.vocab[0].d, p:scramble(u.vocab[0].w) });
            
            state.session = { exercises: p, index: 0, feedback: null, uId, lIdx, selection: [] };
            state.finished = false; state.uFinished = false; state.view = 'lesson';
            render();
        }

        function handleBankTap(word, element) {
            if (state.session.feedback) return;
            state.session.selection.push(word);
            element.classList.add('hidden');
            render();
        }

        function handleSelectionTap(word, index) {
            if (state.session.feedback) return;
            state.session.selection.splice(index, 1);
            render();
        }

        function handleAction() {
            const s = state.session;
            const cur = s.exercises[s.index];
            if(s.feedback || cur.type === 'vocab' || cur.type === 'story_read') {
                if(s.index < 9) { 
                    s.index++; s.feedback = null; s.selection = []; render(); 
                } else { 
                    finishLesson(); 
                }
            } else {
                const userSent = s.selection.join(' ').toUpperCase();
                const targetSent = cur.target.toUpperCase();
                if(userSent === targetSent || (cur.type === 'cloze' && s.selection[0] === cur.target.toUpperCase())) {
                    s.feedback = 'correct';
                } else {
                    s.feedback = 'incorrect';
                }
                render();
            }
        }

        function finishLesson() {
            state.xp += 50; localStorage.setItem('eyean-xp', state.xp);
            state.completed[`${state.session.uId}-${state.session.lIdx}`] = true;
            localStorage.setItem('eyean-lessons', JSON.stringify(state.completed));
            if(state.session.lIdx === 9) state.uFinished = true; else state.finished = true;
            createConfetti(state.uFinished ? 80 : 30);
            render();
        }

        function createConfetti(n) {
            for(let i=0; i<n; i++) {
                const c = document.createElement('div');
                c.className = 'confetti'; c.style.left = Math.random()*100 + '%';
                c.style.backgroundColor = ['#38bdf8', '#f59e0b', '#ffffff'][Math.floor(Math.random()*3)];
                c.style.animationDuration = (Math.random()*2+2)+'s'; document.body.appendChild(c);
                setTimeout(() => c.remove(), 4000);
            }
        }

        function render() {
            const container = document.getElementById('app-content');
            const nav = document.getElementById('footer-nav');
            document.getElementById('xp-val').innerText = state.xp;
            nav.classList.toggle('hidden', state.view === 'lesson');
            
            const tabLinks = ['path', 'trans', 'codex'];
            tabLinks.forEach(t => {
                const el = document.getElementById('nav-'+t);
                if(el) { el.classList.toggle('text-sky-400', state.view===(t==='trans'?'translator':t)); el.classList.toggle('text-slate-600', state.view!==(t==='trans'?'translator':t)); }
            });

            if(state.finished || state.unitFinished) {
                container.innerHTML = `
                <div class="animate-in flex flex-col items-center justify-center min-h-[70vh] text-center p-4">
                    ${state.uFinished ? `
                        <div class="relative mb-8 badge-radiant p-8 rounded-full"><i data-lucide="medal" class="w-32 h-32 text-amber-400 drop-shadow-glow shake"></i></div>
                        <h2 class="text-5xl font-black italic uppercase text-white mb-8">Unit Mastered</h2>
                    ` : `
                        <i data-lucide="trophy" class="w-32 h-32 text-amber-500 mb-8 drop-shadow-glow bounce-slow"></i>
                        <h2 class="text-4xl font-black italic uppercase mb-8">Lesson Mastered!</h2>
                    `}
                    <button onclick="setView('path')" class="w-full bg-white text-slate-950 py-6 rounded-[2.5rem] font-black uppercase text-xl shadow-2xl">Continue</button>
                </div>`;
            } else if (state.view === 'path') {
                container.innerHTML = `
                <div class="animate-in space-y-6">
                    <div class="flex justify-center gap-2 bg-slate-900 p-1 rounded-2xl border border-white/10 mb-8">
                        <button onclick="state.script=1;render()" class="flex-1 py-2 rounded-xl text-[10px] font-black uppercase ${state.script==1?'bg-sky-500 text-slate-950 shadow-lg':'text-slate-500'}">West</button>
                        <button onclick="state.script=2;render()" class="flex-1 py-2 rounded-xl text-[10px] font-black uppercase ${state.script==2?'bg-sky-500 text-slate-950 shadow-lg':'text-slate-500'}">East</button>
                    </div>
                    ${Object.entries(ATLAS).map(([id, u]) => {
                        const uLocked = id > 1 && !state.completed[`${id-1}-9`];
                        return `
                        <div class="bg-[#0f1115] border border-white/5 rounded-[2.5rem] overflow-hidden shadow-2xl transition-all ${uLocked ? 'locked' : ''}">
                            <div class="p-6 flex items-center justify-between" onclick="${uLocked ? '' : `state.activeUnit=${id};render()`}">
                                <div class="flex items-center gap-4">
                                    <div class="w-12 h-12 bg-slate-800 rounded-2xl flex items-center justify-center text-sky-400 shadow-inner"><i data-lucide="${u.icon}"></i></div>
                                    <div><h2 class="text-sky-400 font-black text-[10px] uppercase mb-1">Unit ${id}</h2><p class="font-bold italic text-lg leading-none">${u.title}</p></div>
                                </div>
                                <i data-lucide="${uLocked ? 'lock' : 'chevron-down'}" class="${state.activeUnit==id?'rotate-180':''} text-slate-600 transition-transform"></i>
                            </div>
                            ${state.activeUnit==id && !uLocked ? `
                                <div class="p-4 bg-black/20 grid grid-cols-5 gap-3 border-t border-white/5 animate-in">
                                    ${Array.from({length: 10}).map((_, i) => {
                                        const lock = isLessonLocked(id, i);
                                        const done = state.completed[id+'-'+i];
                                        const next = !done && !lock && (id==1 && i==0 || isLessonLocked(id, i)==false);
                                        return `<button onclick="initLesson(${id}, ${i})" 
                                            class="aspect-square rounded-xl flex items-center justify-center font-black text-xs transition-all 
                                            ${done ? 'bg-sky-500 text-slate-950' : (lock ? 'bg-slate-900 text-slate-700' : 'bg-slate-800 text-slate-400')}
                                            ${next && !done ? 'next-up' : ''}">${lock ? '<i data-lucide="lock" class="w-3 h-3"></i>' : (i+1)}</button>`;
                                    }).join('')}
                                </div>
                            ` : ''}
          
