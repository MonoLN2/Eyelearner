<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Eyean Master Lab</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Space+Mono&display=swap');
        :root { --bg: #050608; --panel: #0f1115; --sky: #38bdf8; --amber: #f59e0b; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: #f1f5f9; overflow-x: hidden; -webkit-tap-highlight-color: transparent; overscroll-behavior-y: contain; }
        .eyean-font { font-family: 'Space Mono', monospace; }
        .animate-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .confetti { position: fixed; width: 8px; height: 8px; top: -10px; border-radius: 2px; animation: fall linear forwards; z-index: 3000; }
        @keyframes fall { to { transform: translateY(100vh) rotate(720deg); } }
        .drop-shadow-glow { filter: drop-shadow(0 0 15px rgba(56, 189, 248, 0.4)); }
        .verify-bar { background: rgba(5, 6, 8, 0.98); backdrop-filter: blur(24px); border-top: 1px solid rgba(255,255,255,0.1); }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .word-chip { transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; border-bottom: 4px solid #000; }
        .word-chip:active { transform: translateY(2px); border-bottom-width: 2px; background: var(--sky); color: #000; }
        .locked { filter: grayscale(1) opacity(0.3); pointer-events: none; }
        .next-up { animation: pulse-border 2s infinite; border-color: var(--sky) !important; transform: scale(1.05); }
        @keyframes pulse-border { 0%, 100% { box-shadow: 0 0 0px var(--sky); } 50% { box-shadow: 0 0 20px var(--sky); } }
        .badge-radiant { background: radial-gradient(circle, rgba(56,189,248,0.2) 0%, transparent 70%); animation: pulse-glow 3s infinite; }
        @keyframes pulse-glow { 0%, 100% { opacity: 0.5; transform: scale(1); } 50% { opacity: 1; transform: scale(1.1); } }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <header class="sticky top-0 z-[100] bg-[#050608]/95 backdrop-blur-lg border-b border-white/5 px-6 py-4 flex justify-between items-center pt-10">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-sky-500 rounded-xl flex items-center justify-center text-slate-950 font-black shadow-lg">E</div>
            <span class="font-black tracking-tighter text-sm uppercase">Eyean Lab</span>
        </div>
        <div class="text-amber-500 font-black text-xs flex items-center gap-1">
            <i data-lucide="sparkles" class="w-4 h-4"></i> <span id="xp-val">0</span>
        </div>
    </header>

    <main id="app-content" class="flex-1 max-w-xl mx-auto w-full p-6 relative pb-40">
        <!-- Views -->
    </main>

    <nav id="footer-nav" class="fixed bottom-0 left-0 right-0 bg-[#050608]/95 backdrop-blur-xl border-t border-white/5 px-6 py-4 flex justify-around items-center z-[90] pb-8">
        <button onclick="setView('path')" id="nav-path" class="flex flex-col items-center gap-1 text-sky-400">
            <i data-lucide="map" class="w-6 h-6"></i><span class="text-[8px] font-black uppercase">Journey</span>
        </button>
        <button onclick="setView('translator')" id="nav-trans" class="flex flex-col items-center gap-1 text-slate-600">
            <i data-lucide="languages" class="w-6 h-6"></i><span class="text-[8px] font-black uppercase">Translator</span>
        </button>
        <button onclick="setView('codex')" id="nav-codex" class="flex flex-col items-center gap-1 text-slate-600">
            <i data-lucide="library" class="w-6 h-6"></i><span class="text-[8px] font-black uppercase">Codex</span>
        </button>
    </nav>

    <script>
        const WEST = { 'A': 'ア', 'B': 'ש', 'C': 'ジ', 'D': '⊣', 'E': 'え', 'F': 'ε', 'G': '↸', 'H': 'チ', 'I': 'ꮦ', 'J': 'Б', 'K': 'ᓭ', 'L': '⎓', 'M': 'ꮏ', 'N': 'ք', 'O': 'ꝋ', 'P': '∷', 'Q': 'פ', 'R': 'ꮭ', 'S': '⋊', 'T': 'ꭴ', 'U': 'µ', 'V': 'ᓵ', 'W': 'ꮑ', 'X': 'є', 'Y': 'よ', 'Z': 'չ' };
        const EAST = { 'A': 'а', 'B': 'в', 'C': 'Ж', 'D': 'г', 'E': 'э', 'F': 'з', 'G': 'д', 'H': 'х', 'I': 'и', 'J': 'Б', 'K': 'с', 'L': 'ф', 'M': 'т', 'N': 'п', 'O': 'ꝋ', 'р': 'р', 'Q': 'פ', 'R': 'ꮭ', 'S': 'к', 'T': 'ꭴ', 'U': 'у', 'V': 'ᓵ', 'W': 'н', 'X': 'є', 'Y': 'й', 'Z': 'չ' };
        const SPOKEN = { 'A': 'A', 'B': 'V', 'C': 'ZH', 'D': 'G', 'E': 'E', 'F': 'Z', 'G': 'D', 'H': 'H', 'I': 'I', 'J': 'B', 'K': 'S', 'L': 'F', 'M': 'T', 'N': 'P', 'O': 'O', 'P': 'R', 'Q': 'Q', 'R': 'L', 'S': 'K', 'T': 'M', 'U': 'U', 'V': 'C', 'W': 'N', 'X': 'X', 'Y': 'Y', 'Z': 'Z' };

        const ATLAS = {
            1: { title: "Identity", icon: "user", 
                 vocab: [{w:'HELLO',d:'Greeting'},{w:'NAME',d:'Identity'},{w:'ELIAS',d:'Proper'},{w:'SARAH',d:'Proper'},{w:'FRIEND',d:'Ally'},{w:'AM',d:'Be(1st)'},{w:'ARE',d:'Be(2nd)'},{w:'KIND',d:'Nice'},{w:'GOOD',d:'Safe'},{w:'THANKS',d:'Thanks'}],
                 sentences: ["I AM ELIAS", "YOU ARE SARAH", "SARAH IS MY FRIEND", "HELLO MY NAME IS ELIAS"],
                 story: { title: "The Border Gate", chat: [
                     {s:"Elias",l:"HELLO I AM ELIAS"},
                     {s:"Sarah",l:"HELLO ELIAS I AM SARAH"},
                     {s:"Elias",l:"YOU ARE MY NEW FRIEND"},
                     {s:"Sarah",l:"YES I AM YOUR GOOD FRIEND"},
                     {s:"Elias",l:"THANKS FOR THE KIND NAME"}
                 ] }
            },
            2: { title: "Motion", icon: "activity", 
                 vocab: [{w:'HEAD',d:'Top'},{w:'HAND',d:'Grab'},{w:'LEG',d:'Walk'},{w:'KAEL',d:'Proper'},{w:'MIRA',d:'Proper'},{w:'RUN',d:'Fast'},{w:'WALK',d:'Slow'},{w:'STOP',d:'Stay'},{w:'FAST',d:'High Speed'},{w:'STRONG',d:'Strong'}],
                 sentences: ["KAEL RUNS FAST", "MIRA WALKS SLOW", "STOP THE MOVE", "MY BODY IS STRONG"],
                 story: { title: "The Fitness Check", chat: [
                     {s:"Kael",l:"I RUN FAST MIRA"},
                     {s:"Mira",l:"LOOK AT MY LEG KAEL"},
                     {s:"Kael",l:"YOUR LEG IS STRONG"},
                     {s:"Mira",l:"STOP THE RUN NOW"},
                     {s:"Kael",l:"I WALK SLOW TO THE CITY"}
                 ] }
            },
            3: { title: "Gaia", icon: "sun", 
                 vocab: [{w:'TREE',d:'Plant'},{w:'RIVER',d:'Water'},{w:'SUN',d:'Star'},{w:'SKY',d:'Above'},{w:'DARK',d:'Dim'},{w:'ORION',d:'Proper'},{w:'GAIA',d:'Proper'},{w:'GREEN',d:'Nature'},{w:'EARTH',d:'Ground'},{w:'LIGHT',d:'Light'}],
                 sentences: ["THE SUN IS BRIGHT", "GAIA SEES THE TREE", "THE RIVER IS GREEN", "SKY IS BLUE"],
                 story: { title: "Forest Survey", chat: [
                     {s:"Orion",l:"THE SUN IS BRIGHT GAIA"},
                     {s:"Gaia",l:"I SEE THE BLUE SKY"},
                     {s:"Orion",l:"THE RIVER IS GREEN HERE"},
                     {s:"Gaia",l:"THE EARTH IS DARK NOW"},
                     {s:"Orion",l:"GREEN IS GOOD FOR TREE"}
                 ] }
            },
            4: { title: "Labor", icon: "briefcase", 
                 vocab: [{w:'BOSS',d:'Lead'},{w:'CLERK',d:'Worker'},{w:'OFFICE',d:'Room'},{w:'TOOL',d:'Item'},{w:'BUILD',d:'Create'},{w:'JOB',d:'Task'},{w:'WAGE',d:'Pay'},{w:'DESK',d:'Surface'},{w:'PAPER',d:'Sheet'},{w:'PEN',d:'Writer'}],
                 sentences: ["THE BOSS BUILDS A TOOL", "I WORK AT THE OFFICE", "THE JOB IS BUSY", "I WANT THE WAGE"],
                 story: { title: "Office Day", chat: [
                     {s:"Supervisor",l:"BUILD THE TOOL NOW"},
                     {s:"Clerk",l:"I AM BUSY AT THE DESK"},
                     {s:"Supervisor",l:"FINISH THE JOB NOW"},
                     {s:"Clerk",l:"I WANT MY WAGE"},
                     {s:"Supervisor",l:"YOU EARN THE GOOD WAGE"}
                 ] }
            },
            5: { title: "Justice", icon: "shield", 
                 vocab: [{w:'JUDGE',d:'Official'},{w:'KING',d:'Ruler'},{w:'LAW',d:'Rules'},{w:'VOTE',d:'Choice'},{w:'PEACE',d:'Calm'},{w:'WAR',d:'Fight'},{w:'GUARD',d:'Protect'},{w:'CITIZEN',d:'Person'},{w:'TRUTH',d:'Fact'},{w:'RIGHT',d:'Correct'}],
                 sentences: ["THE KING RULES LAND", "THE LAW IS REAL", "VOTE FOR PEACE", "JUSTICE IS TRUTH"],
                 story: { title: "High Decree", chat: [
                     {s:"Judge",l:"THE LAW IS REAL CITIZEN"},
                     {s:"Citizen",l:"I VOTE FOR PEACE NOW"},
                     {s:"Judge",l:"THE KING RULES THE LAND"},
                     {s:"Citizen",l:"TRUTH IS POWER HERE"},
                     {s:"Judge",l:"HONOR THE LAW ALWAYS"}
                 ] }
            },
            6: { title: "Education", icon: "scroll", 
                 vocab: [{w:'MENTOR',d:'Teacher'},{w:'SEEKER',d:'Student'},{w:'DREAM',d:'Vision'},{w:'MAGIC',d:'Energy'},{w:'CORE',d:'Center'},{w:'VOID',d:'Empty'},{w:'KNOW',d:'Understand'},{w:'MIND',d:'Mind'},{w:'REAL',d:'Exist'},{w:'OPEN',d:'Open'}],
                 sentences: ["I KNOW THE CORE", "THE DREAM IS REAL", "OPEN THE MIND", "MAGIC IS CORE"],
                 story: { title: "Lesson One", chat: [
                     {s:"Mentor",l:"SEEKER OPEN THE MIND"},
                     {s:"Seeker",l:"I KNOW THE CORE IS REAL"},
                     {s:"Mentor",l:"DREAM THE MAGIC NOW"},
                     {s:"Seeker",l:"THE VOID IS OPEN"},
                     {s:"Mentor",l:"YOU ARE A GOOD SEEKER"}
                 ] }
            },
            7: { title: "Signals", icon: "waves", 
                 vocab: [{w:'PILOT',d:'Flyer'},{w:'TOWER',d:'Base'},{w:'RAIN',d:'Water'},{w:'SNOW',d:'Ice'},{w:'STORM',d:'Wind'},{w:'HOT',d:'Heat'},{w:'SIGNAL',d:'Comm'},{w:'FLY',d:'Fly'},{w:'LAND',d:'Land'},{w:'SAFE',d:'Safe'}],
                 sentences: ["PILOT SEES THE RAIN", "STORM IS NEAR", "SIGNAL IS GOOD", "GO TO THE TOWER"],
                 story: { title: "Radio Check", chat: [
                     {s:"Pilot",l:"TOWER THE STORM IS NEAR"},
                     {s:"Tower",l:"GO LOW PILOT STAY SAFE"},
                     {s:"Pilot",l:"I SEE THE RAIN NOW"},
                     {s:"Tower",l:"THE SIGNAL IS GOOD"},
                     {s:"Pilot",l:"I LAND AT THE CITY"}
                 ] }
            },
            8: { title: "Trade", icon: "coins", 
                 vocab: [{w:'MERCHANT',d:'Seller'},{w:'BOIR',d:'Coin'},{w:'COST',d:'Value'},{w:'PAY',d:'Give'},{w:'TEN',d:'10'},{w:'ONE',d:'1'},{w:'FOOD',d:'Fuel'},{w:'BUY',d:'Take'},{w:'SELL',d:'Give'},{w:'GOLD',d:'Gold'}],
                 sentences: ["FOOD COSTS TEN BOIR", "I PAY ONE BOIR", "BUY THE GOLD", "MERCHANT SELLS FOOD"],
                 story: { title: "Market Talk", chat: [
                     {s:"Merchant",l:"THE FOOD IS TEN BOIR"},
                     {s:"Buyer",l:"I PAY ONE BOIR ONLY"},
                     {s:"Merchant",l:"NO I SELL FOR TEN"},
                     {s:"Buyer",l:"I BUY THE GOLD BAG"},
                     {s:"Merchant",l:"GOOD I TAKE THE PAY"}
                 ] }
            },
            9: { title: "Voyage", icon: "compass", 
                 vocab: [{w:'CAPTAIN',d:'Boss'},{w:'SAILOR',d:'Worker'},{w:'SHIP',d:'Vessel'},{w:'MAP',d:'Guide'},{w:'WAY',d:'Route'},{w:'CITY',d:'Hub'},{w:'SEA',d:'Water'},{w:'PORT',d:'Harbor'},{w:'GO',d:'Leave'},{w:'LAND',d:'Land'}],
                 sentences: ["CAPTAIN HAS THE MAP", "SHIP GOES FAR", "CITY IS NEAR", "SEA IS BLUE"],
                 story: { title: "Captain Log", chat: [
                     {s:"Captain",l:"SAILOR I HAVE THE MAP"},
                     {s:"Sailor",l:"THE SHIP GOES FAR NOW"},
                     {s:"Captain",l:"GO TO THE CITY PORT"},
                     {s:"Sailor",l:"THE SEA IS BLUE TODAY"},
                     {s:"Captain",l:"GOOD STAY ON THE WAY"}
                 ] }
            },
            10: { title: "The Atlas", icon: "flag", 
                  vocab: [{w:'USA',d:'Land'},{w:'CHINA',d:'Land'},{w:'JAPAN',d:'Land'},{w:'WORLD',d:'All'},{w:'BORDER',d:'Edge'},{w:'BIG',d:'Large'},{w:'PEOPLE',d:'Humans'},{w:'MAPMAKER',d:'Artist'},{w:'EXPLORER',d:'Traveler'},{w:'FAR',d:'Far'}],
                  sentences: ["JAPAN IS FAR", "USA IS BIG", "FRANCE IS BEAUTIFUL", "THE WORLD IS ONE"],
                  story: { title: "World Map", chat: [
                      {s:"Explorer",l:"THE WORLD IS ONE TOTAL"},
                      {s:"Mapmaker",l:"JAPAN IS FAR FROM HERE"},
                      {s:"Explorer",l:"I SEE THE CHINA BORDER"},
                      {s:"Mapmaker",l:"USA IS A BIG LAND"},
                      {s:"Explorer",l:"I TRAVEL THE WORLD"}
                  ] }
            },
            11: { title: "Harmony", icon: "music", 
                  vocab: [{w:'SOLOIST',d:'One'},{w:'CONDUCTOR',d:'Lead'},{w:'DRUM',d:'Beat'},{w:'VIOLIN',d:'String'},{w:'SING',d:'Vocal'},{w:'SONG',d:'Music'},{w:'LOUD',d:'High'},{w:'SOFT',d:'Low'},{w:'PLAY',d:'Act'},{w:'HEAR',d:'Hear'}],
                  sentences: ["I PLAY THE DRUM", "SOLOIST PLAYS VIOLIN", "THE SONG IS LOUD", "HEAR THE MUSIC"],
                  story: { title: "Rehearsal", chat: [
                      {s:"Soloist",l:"THE SONG IS LOUD CONDUCTOR"},
                      {s:"Conductor",l:"PLAY SOFT SONG NOW"},
                      {s:"Soloist",l:"I PLAY VIOLIN"},
                      {s:"Conductor",l:"I HEAR THE GOOD BAND"},
                      {s:"Soloist",l:"HEAR THE MUSIC FLOW"}
                  ] }
            },
            12: { title: "TOTAL SYNC", icon: "zap", 
                  vocab: [{w:'VOICE',d:'Signal'},{w:'MASTER',d:'High'},{w:'SYNC',d:'Align'},{w:'EYEAN',d:'System'},{w:'TOTAL',d:'Whole'},{w:'ALL',d:'Every'},{w:'END',d:'Final'},{w:'PEACE',d:'Calm'},{w:'KNOW',d:'Understand'},{w:'LIFE',d:'Life'}],
                  sentences: ["EYEAN IS REAL", "THE SYNC IS MASTER", "THE END IS NEAR", "PEACE IS TOTAL"],
                  story: { title: "Final Sync", chat: [
                      {s:"Voice",l:"TOTAL SYNC IS MASTER"},
                      {s:"Master",l:"EYEAN IS THE END"},
                      {s:"Voice",l:"I KNOW THE ALL"},
                      {s:"Master",l:"PEACE IS REAL TOTAL"},
                      {s:"Voice",l:"SYNC IS DONE"}
                  ] }
            }
        };

        let state = {
            view: 'path',
            xp: parseInt(localStorage.getItem('eyean-xp') || 0),
            completed: JSON.parse(localStorage.getItem('eyean-lessons') || '{}'),
            activeUnit: 1, script: 1, session: null, finished: false, uFinished: false, transIn: ''
        };

        function setView(v) { state.view = v; state.finished = false; state.uFinished = false; render(); }
        function scramble(w) { return w ? (w.toUpperCase()==='BOIR' ? 'BOIR' : w.toUpperCase().split('').map(c => SPOKEN[c] || c).join('')) : ""; }
        function scriptify(w, s) { if(!w) return ""; if(w.toUpperCase()==='BOIR' && s===1) return 'Бꝋꮦ∷'; const map = s===1 ? WEST : EAST; return w.toUpperCase().split('').map(c => map[c] || c).join(''); }

        function isLessonLocked(uId, lIdx) {
            uId = Number(uId); lIdx = Number(lIdx);
            if (uId === 1 && lIdx === 0) return false;
            if (lIdx > 0) return !state.completed[`${uId}-${lIdx - 1}`];
            return !state.completed[`${uId - 1}-9`];
        }

        function initLesson(uId, lIdx) {
            if (isLessonLocked(uId, lIdx)) return;
            const u = ATLAS[uId];
            let p = [];
            const offset = (lIdx % 4) * 2;
            u.vocab.slice(offset, offset + 4).forEach(v => p.push({ type:'vocab', word:v.w, d:v.d, p:scramble(v.w) }));
            if (lIdx === 4) {
                p.push({ type:'story_read', story:u.story });
                const spk = u.story.chat[0].s.toUpperCase();
                p.push({ type:'cloze', en:`LOG: WHO SENDS THE SIGNAL?`, target:spk, opts:[spk, "KING", "VOID"] });
            } else {
                const s = u.sentences[lIdx % u.sentences.length];
                const words = s.split(' ');
                const t = words[words.length - 1];
                p.push({ type:'sentence', en:s, target:s, bank: [...words, 'VOID', 'DARK', 'REAL'].sort(() => Math.random() - 0.5) });
            }
            while(p.length < 10) p.push({ type:'vocab', word:u.vocab[0].w, d:u.vocab[0].d, p:scramble(u.vocab[0].w) });
            state.session = { exercises: p, index: 0, feedback: null, uId, lIdx, selection: [] };
            state.finished = false; state.uFinished = false; state.view = 'lesson';
            render();
        }

        function handleAction() {
            const s = state.session;
            const cur = s.exercises[s.index];
            if(s.feedback || cur.type === 'vocab' || cur.type === 'story_read') {
                if(s.index < 9) { s.index++; s.feedback = null; s.selection = []; render(); }
                else { finishLesson(); }
            } else {
                s.feedback = 'correct'; render();
            }
        }

        function finishLesson() {
            state.xp += 50; 
            state.completed[`${state.session.uId}-${state.session.lIdx}`] = true;
            localStorage.setItem('eyean-xp', state.xp);
            localStorage.setItem('eyean-lessons', JSON.stringify(state.completed));
            if(state.session.lIdx === 9) state.uFinished = true; else state.finished = true;
            createConfetti(state.uFinished ? 80 : 30);
            render();
        }

        function createConfetti(n) {
            for(let i=0; i<n; i++) {
                const c = document.createElement('div');
                c.className = 'confetti'; c.style.left = Math.random()*100 + '%';
                c.style.backgroundColor = ['#38bdf8', '#f59e0b', '#ffffff'][Math.floor(Math.random()*3)];
                c.style.animationDuration = (Math.random()*2+2)+'s'; document.body.appendChild(c);
                setTimeout(() => c.remove(), 4000);
            }
        }

        function render() {
            const container = document.getElementById('app-content');
            const nav = document.getElementById('footer-nav');
            document.getElementById('xp-val').innerText = state.xp;
            nav.classList.toggle('hidden', state.view === 'lesson');
            
            const tabLinks = ['path', 'trans', 'codex'];
            tabLinks.forEach(t => {
                const el = document.getElementById('nav-'+t);
                if(el) { el.classList.toggle('text-sky-400', state.view===(t==='trans'?'translator':t)); el.classList.toggle('text-slate-600', state.view!==(t==='trans'?'translator':t)); }
            });

            if(state.finished || state.uFinished) {
                container.innerHTML = `<div class="animate-in flex flex-col items-center justify-center min-h-[70vh] text-center p-4">
                    ${state.uFinished ? `
                        <div class="relative mb-8 badge-radiant p-8 rounded-full"><i data-lucide="medal" class="w-32 h-32 text-amber-400 drop-shadow-glow"></i></div>
                        <h2 class="text-5xl font-black italic uppercase text-white mb-8">Unit Mastered</h2>
                    ` : `
                        <i data-lucide="trophy" class="w-32 h-32 text-amber-500 mb-8 drop-shadow-glow bounce-slow"></i>
                        <h2 class="text-4xl font-black uppercase italic mb-8">Lesson Mastered!</h2>
                    `}
                    <button onclick="setView('path')" class="w-full bg-white text-slate-950 py-6 rounded-[2.5rem] font-black uppercase text-xl shadow-2xl">Continue</button>
                </div>`;
            } else if (state.view === 'path') {
                container.innerHTML = `
        
